# SAGE 系統壓縮比分析指南

## 壓縮比定義與意義

根據論文 ch4.md 第22行，SAGE 系統的資料壓縮比分為三個層次：

1. **封包級壓縮比** = 原始封包數 / 攻擊圖節點數
2. **日誌級壓縮比** = Zeek 日誌記錄數 / 攻擊圖節點數  
3. **事件級壓縮比** = 抽象事件數 / 攻擊圖節點數

### 壓縮比的意義

- **高壓縮比**：表示系統能夠有效提取關鍵資訊，過濾噪音資料
- **適度壓縮**：平衡資訊保留與簡化程度
- **過高壓縮**：可能意味著資訊損失，需要結合其他指標評估

## 實際案例分析

### 案例一：查詢洪水攻擊（Query Flooding）

這是論文中壓縮比最高的案例，展現 SAGE 處理大規模重複攻擊的能力。

#### 原始數據
```
封包數量：75,678 個
Zeek 日誌：98,200 筆
- Modbus 交易：37,770 筆
- 安全告警：22,652 筆
- 其他日誌：37,778 筆
抽象事件：20 種
攻擊圖：5 張
```

#### 壓縮比計算

假設每張攻擊圖平均 5 個節點，總節點數 = 5 × 5 = 25

```
封包級壓縮比 = 75,678 / 25 = 3,027:1
日誌級壓縮比 = 98,200 / 25 = 3,928:1
事件級壓縮比 = 20 / 25 = 0.8:1

整體壓縮比 = 98,200 / 5 = 19,640:1
```

**論文記載**：ch4.md 第47行「壓縮比達到驚人的 19,640:1」

#### 為什麼壓縮比這麼高？

1. **大量重複事件**：查詢洪水攻擊產生大量相同的查詢請求
2. **S-PDFA 的優勢**：能識別重複模式並合併
3. **事件抽象化**：將 15,003 個唯一簽章壓縮為 20 個語意事件

### 案例二：SCADA HMI 真實攻擊

這是大規模真實環境的案例，展現系統的實用性。

#### 原始數據
```
封包數量：1,172,000 個
時間跨度：8.3 小時
原始告警：134,494 筆
去重後告警：15,150 筆 (11.3%)
攻擊圖：17 張
```

#### 多階段壓縮過程

根據 ch4.md 第100行，壓縮過程分為四個階段：

| 階段 | 輸入 | 輸出 | 壓縮比 | 說明 |
|------|------|------|--------|------|
| 1. Zeek 解析 | 96 MB PCAP | ~28 MB 日誌 | 3.4:1 | 提取協定語意 |
| 2. 日誌整合 | 多源日誌 | 統一告警 | 8.9:1 | 語意統一 |
| 3. S-PDFA 學習 | 告警序列 | 行為模型 | 891:1 | 捕捉行為模式 |
| 4. 圖生成 | 複雜模型 | 17 張圖 | 3.5:1 | 提升可解釋性 |

**總體壓縮比** = 3.4 × 8.9 × 891 × 3.5 ≈ 8,900:1

**論文記載**：ch4.md 第99行「總體壓縮比達到 8,900:1」

### 案例三：各攻擊類型壓縮比比較

| 攻擊類型 | 封包數 | 攻擊圖數 | 估計壓縮比 | 特點 |
|----------|--------|-----------|------------|------|
| Baseline Replay | 467 | 53 | 9:1 | 多目標分散 |
| False Injection | 374 | 4 | 94:1 | 集中攻擊 |
| Modify Length | 381 | 2 | 191:1 | 簡單模式 |
| Query Flooding | 75,678 | 5 | 19,640:1 | 大量重複 |
| Reconnaissance | 673 | 1 | 673:1 | 單一行為 |
| Stack Frames | 368 | 4 | 92:1 | 中等複雜 |
| Write All Coils | 495 | 3 | 165:1 | 批量操作 |

## 壓縮比計算實務

### 使用計算工具

```bash
# 執行壓縮比計算工具
python3 calculate_compression_ratio.py

# 分析特定攻擊
python3 calculate_compression_ratio.py "Query Flooding" \
    data/query_flooding.pcap \
    logs/ \
    events.json \
    attack_graphs/
```

### 手動計算步驟

1. **收集原始數據**
   ```bash
   # 計算封包數
   capinfos attack.pcap | grep "Number of packets"
   
   # 計算日誌記錄數
   wc -l *.log
   
   # 計算攻擊圖數量
   ls attack_graphs/*.dot | wc -l
   ```

2. **估算節點數**
   ```bash
   # 分析 DOT 檔案
   grep -c "label=" attack_graphs/*.dot
   ```

3. **計算壓縮比**
   ```
   封包級 = 封包數 / 節點總數
   日誌級 = 日誌記錄數 / 節點總數
   事件級 = 事件類型數 / 節點總數
   ```

## 壓縮比的評估標準

### 良好的壓縮比特徵

1. **適度範圍**：100:1 到 10,000:1
2. **保留關鍵資訊**：所有攻擊步驟都被識別
3. **可解釋性**：生成的攻擊圖清晰易懂

### 異常壓縮比的警示

1. **過低（< 10:1）**
   - 可能過度保留細節
   - 攻擊圖過於複雜

2. **過高（> 100,000:1）**
   - 可能遺失重要資訊
   - 需要檢查抽象化規則

## 實驗復現注意事項

1. **確保數據完整性**
   - 檢查所有日誌檔案是否生成
   - 確認攻擊圖數量與論文一致

2. **記錄中間結果**
   - 保存各階段的數據量
   - 截圖重要輸出

3. **異常處理**
   - 如果壓縮比與論文差異過大，檢查：
     - Zeek 版本是否正確
     - ICSNPP 模組是否載入
     - 事件抽象化規則是否完整

## 總結

SAGE 系統的高壓縮比展現其優異的資料精煉能力：

- **查詢洪水攻擊**：19,640:1 - 處理大規模重複攻擊
- **SCADA HMI 攻擊**：8,900:1 - 處理真實複雜環境
- **事件抽象化**：764:1 - 將 15,289 個簽章壓縮為 20 個事件

這些數據證明 SAGE 能有效解決工控安全分析中的資料過載問題，同時保留關鍵的攻擊資訊。